<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="description" content="A fully featured admin theme which can be used to build CRM, CMS, etc.">
    <meta name="author" content="Coderthemes">
    <link href="http://eip.unisoc.com/sites/howto/ProcessCenter/menu_2/assets/css/bootstrap.min.css" rel="stylesheet" type="text/css" />
    <link href="http://eip.unisoc.com/sites/howto/ProcessCenter/menu_2/assets/css/core.css" rel="stylesheet" type="text/css" />
    <link href="http://eip.unisoc.com/sites/howto/ProcessCenter/menu_2/assets/css/icons.css" rel="stylesheet" type="text/css" />
    <link href="http://eip.unisoc.com/sites/howto/ProcessCenter/menu_2/assets/css/pages.css" rel="stylesheet" type="text/css" />
    <link href="http://eip.unisoc.com/sites/howto/ProcessCenter/menu_2/assets/css/menu.css" rel="stylesheet" type="text/css" />
    <link href="http://eip.unisoc.com/sites/howto/ProcessCenter/menu_2/assets/css/components.css" rel="stylesheet" type="text/css" />
    <link href="http://eip.unisoc.com/sites/howto/ProcessCenter/menu_2/assets/css/sprdIcon.css?v=1.1.1.1" rel="stylesheet" type="text/css" />
    <link href="http://eip.unisoc.com/sites/howto/ProcessCenter/menu_2/assets/css/app_color.css?v=1.1.2.1" rel="stylesheet" type="text/css" />
    <script type="text/javascript" src="../js/vue.min.js"></script>
    <style>
        .col-md-offset-1 {
            margin-left: 0 !important;
        }

        #DeltaPlaceHolderMain {
            padding: 0 !important
        }

        .container {
            padding-left: 0 !important;
        }

        table {
            background-color: white !important
        }

        .col-sm-1 {
            width: 10% !important;
        }

        h5 {
            margin-top: 8px !important;
            height: 33px;
        }

        input[type=button], input[type=reset], input[type=submit], button {
            min-width: 3em
        }
        #s4-workspace{
            overflow:inherit !important
        }
        body{
            overflow:scroll
        }
    </style>
</head>
<body>
    <div class="wrapper" id="app">
        <div class="container">
            <div class="row">
                <div class="col-md-12 col-md-offset-1">
                    <div class="p-20">
                        <div class="input-group" style="margin:0 auto;width:30%">
                            <span class="input-group-btn">
                                <button type="button" class="btn waves-effect waves-light btn-primary">Q</button>
                            </span>
                            <input type="text" id="example-input3-group2" name="example-input3-group2" v-model="searchText" class="form-control" placeholder="Search">
                        </div>
                        <div class="m-t-50 p-t-10" v-for="List in AllDataList">
                            <h4 class="text-uppercase"><i class="mdi mdi-account-multiple"></i>{{List.Name}}</h4>
                            <div class="border m-b-30"></div>
                            <div class="row">
                                <process-center v-for="DL in List.Data"
                                                v-on:jump-link="Goto(DL.JumpLink)"
                                                v-bind:Li="DL"
                                                v-bind:key="DL.Id">
                                </process-center>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
    <script>
        Vue.component('process-center', {
            props: ['Li'],
            template: '<div class="col-sm-1"  v-if="Li.isShow"><div class="about-features-box text-center"><div v-on:click="$emit(\'jump-link\')" style="cursor:pointer"><div class="feature-icon"><img v-bind:class="Li.Icon" src="http://eip.unisoc.com/sites/howto/ProcessCenter/menu_2/assets/images/icons/tm.png"></div><h5>{{Li.Name}}</h5></div>'+
                '<a v-bind:href="Li.HelpLink"><span class="app-link-help">帮助链接</span></a></div></div> '
        })
        var vm = new Vue({
            el: '#app',
            data: {
                ShowDataList: [],
                BakDataList:[],
                searchText:''
            },
            created:function() {
                var data = this.getListJson();
                this.ShowDataList = data;
                this.BakDataList = JSON.parse(JSON.stringify(data))
            },
            computed: {
                AllDataList: function () {
                    if (this.searchText == "" || !this.searchText) {
                        return this.BakDataList;
                    } else {
                        this.ShowDataList.forEach(function (AL) {
                            AL.Data.forEach(function (DD) {
                                DD.isShow = true;
                                if (DD.Name.indexOf(vm.searchText) < 0) {
                                    DD.isShow = false;
                                }
                            })
                        })
                        return this.ShowDataList
                    }
                }
            },
            methods: {
                getListJson: function () {
                    var AllDataList = [];
                    $.ajax({
                        url: _spPageContextInfo.webAbsoluteUrl + "/_api/web/lists/getByTitle('ProcessCenter')/items?$select=Title,EnglishTitle,CategoryID,ParentID,Icon,JumpLink,HelpLink",
                        contentType: "application/json;odata=verbose",
                        headers: { "accept": "application/json;odata=verbose" },
                        async: false,
                        success: function (data) {
                            if (data.d.results) {
                                data.d.results.forEach(function (i) {
                                    if (i.CategoryID) {
                                        var CategoryList = {};
                                        CategoryList.Id = i.CategoryID;
                                        CategoryList.Name = i.Title;
                                        CategoryList.Data = [];
                                        AllDataList.push(CategoryList)
                                    }
                                })
                                AllDataList.forEach(function (AL) {
                                    var DDL = [];
                                    data.d.results.forEach(function (DD) {
                                        if (!DD.CategoryID && DD.ParentID == AL.Id) {
                                            var LI = {};
                                            LI.Name = DD.Title;
                                            LI.Icon = DD.Icon;
                                            LI.JumpLink = DD.JumpLink ? DD.JumpLink.Url : '';
                                            LI.HelpLink = DD.HelpLink ? DD.HelpLink.Url : '';
                                            LI.isShow = true;
                                            DDL.push(LI);
                                        }
                                    })
                                    AL.Data = DDL;
                                })

                            }
                        },
                        error: function (xhr) {
                        }
                    });
                    return AllDataList;
                },
                Goto: function (url) {
                    window.location.href = url;
                }
            }
        })
    </script>
</body>
</html>